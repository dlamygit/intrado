---

- name: Print item data
  debug: msg="{{ item.datastore }} at {{ item.datacenter_name }}"

- name: Gather info from datacenter about specific datastore
  vmware_datastore_info:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    name: "{{ item.datastore }}"
    validate_certs: no
    datacenter: "{{ item.datacenter_name }}"
  delegate_to: localhost
  register: datastore_info

- name: Print datastore_info
  debug: msg="{{ datastore_info }}"

- name: Print datastore_info.datastores
  debug: msg="{{ datastore_info.datastores }}"

- fail:
    msg: The datastore does not exist
  when: (datastore_info.datastores is defined) and (datastore_info.datastores|length > 0)