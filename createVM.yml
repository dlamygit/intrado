---
- hosts: {{host}}
  tasks:
  - name: Create a virtual machine on given ESXi hostname
    vmware_guest:
    hostname: {{host_ip}}
    username: root
    password: P4$$word!
    validate_certs: no
    folder: /
    name: {{name_vm}}
    state: poweredon
    guest_id: {{guest_id}}
    # This is hostname of particular ESXi server on which user wants VM to be deployed
    esxi_hostname: {{host}}
    disk:
    - size_gb: {{store_size}}
      type: thin
      datastore: {{datastore}}
    hardware:
      memory_mb: {{memory_mb}}
      num_cpus: {{num_cpus}}
      scsi: paravirtual
    networks:
    - name: VM Network
      mac: aa:bb:dd:aa:00:14
      ip: 10.10.10.100
      netmask: 255.255.255.0
      device_type: vmxnet3
    wait_for_ip_address: yes
    delegate_to: localhost
    register: deploy_vm
    
